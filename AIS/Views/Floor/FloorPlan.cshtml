@model AISModels.FloorPlan
@{
    ViewBag.Title = "EditfloorPlan";
    Layout = "~/Views/Shared/_LayoutBase.cshtml";
}
@section styles
{
    <link href="../../Content/themes/base/jquery.ui.datepicker.css" rel="stylesheet"
        type="text/css" />
    <link href="../../css/drag-slider.css" rel="stylesheet" type="text/css" />
    <link href="../../css/jquery.cluetip.css" rel="stylesheet" type="text/css" />
    <style type="text/css">
        .hasDatepicker
        {
            margin-left: -20px;
            position: relative;
            width: 16px;
            border: 0 none;
        }
        
        .ui-state-default, .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default
        {
            color: #555555;
            font-weight: normal;
        }
        .ui-datepicker .ui-datepicker-header
        {
            padding: 0.2em 0;
            position: relative;
        }
        
        
        .ui-state-default, .ui-widget-content .ui-state-default, .ui-widget-header .ui-state-default
        {
            background: url("/images/ui-bg_glass_75_e6e6e6_1x400.png") repeat-x scroll 50% 50% #E6E6E6;
            color: #555555;
            font-weight: normal;
        }
        .ui-datepicker td span, .ui-datepicker td a
        {
            display: block;
            padding: 0.2em;
            text-align: right;
            text-decoration: none;
        }
        .ui-datepicker.ui-widget.ui-widget-content.ui-helper-clearfix.ui-corner-all
        {
            background: none repeat scroll 0 0 #FFFFFF;
            border: 1px solid #AAAAAA;
            border-radius: 5px;
            color: #222222;
            margin-left: -123px;
            margin-top: 42px;
        }
        
        .secHover
        {
            background: #0489B1 !important;
            border: 1px solid #FF0000 !important;
            transition: none;
        }
        .settings .menu-bar
        {
            z-index: 9 !important;
        }
        .quan-2-other1 h3, .quan-2-1 h3, .quan-4-1 h3
        {
            color: #3D3D3D;
            float: left;
            font-family: 'Lato' ,sans-serif;
            font-size: 14px;
            font-weight: 700;
            padding: 6px 0 0 6px;
            width: auto;
        }
        
        .floor .table-main h3.quan-2-h
        {
            color: #3D3D3D;
            float: none;
            font-family: 'Lato' ,sans-serif;
            font-size: 14px;
            font-weight: 700;
            padding: 6px 0 0;
        }
        
        .floor .table-main p
        {
            bottom: 5px;
            color: #878787;
            float: left;
            font-family: 'Lato' ,sans-serif;
            font-size: 14px;
            font-weight: 700;
            padding: 2px 0 0 14px;
            position: absolute;
            right: 5px;
            text-align: right;
            margin: 0;
        }
        
        .floor .table-main p.quan-2-p
        {
            bottom: 6px;
            color: #878787;
            float: left;
            font-family: 'Lato' ,sans-serif;
            font-size: 14px;
            font-weight: 700;
            position: absolute;
            right: 0;
            padding: 0;
            text-align: center;
            width: 100%;
            margin: 0;
        }
        
        /*
        img.table-img
        {
            position: absolute;
            right: 19px;
            top: 11px;
            z-index: 9;
        }
        */
        img.table-img
        {
            left: -12px;
            position: absolute;
            top: 34%;
            z-index: 9;
        }
        
        .pop-sec-btn input[type="button"]
        {
            float: none;
            margin-right: inherit;
        }
        
        .frnt-right-popup
        {
            height: auto;
            position: relative;
        }
        
        .mCSB_scrollTools
        {
            z-index: -1 !important;
        }
        
        .frnt-right-rowb .resInfo ul.reslist li p:nth-child(4)
        {
            text-align: center;
            width: 42px;
        }
        
        .pop-sec-btn input[type="button"]
        {
            background: none repeat scroll 0 0 #FFFFFF;
            border: 1px solid #D0D4D9;
            border-radius: 4px;
            box-shadow: 0 2px 0 #D1D1D1;
            color: #434A54;
            cursor: pointer;
            font-family: 'Lato' ,sans-serif;
            font-size: 16px;
            padding: 10px 25px;
        }
        
        .nav
        {
            background: none repeat scroll 0 0 #FFFFFF;
            border-radius: 5px;
            box-shadow: 0 3px 0 #CFCFCF;
            height: 42px;
            left: 50px;
            padding: 0 25px;
            position: absolute;
            top: 2px;
            z-index: 1;
        }
        .ui-datepicker .ui-datepicker-next
        {
            right: 14px !important;
        }
        
        .frnt-right-rowb .resInfo ul.reslist li a
        {
            float: left;
            width: 100%;
            box-sizing: border-box;
            -moz-box-sizing: border-box;
        }
    </style>
}
@section scripts
{
    <script src="../../Scripts/FloorPlan/FloorPlan.js" type="text/javascript"></script>
    <script src="../../Scripts/Floor/Reservations.js" type="text/javascript"></script>
    <script type="text/javascript" src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
    <script src="../../Scripts/jquery.ui.touch-punch.min.js" type="text/javascript"></script>
    <script src="../../js/jquery.hoverIntent.js" type="text/javascript"></script>
    <script src="../../js/jquery.cluetip.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $(".wrapper").addClass('wrapper-floor');
            $('body').css('background', 'url("../images/body-bg.png") repeat scroll 0 0 rgba(0, 0, 0, 0)');
            var className = $('.middle-section').attr('class');
            console.log(className);
            if (className == "middle-section floor middle-section-toggle2 middle-section-toggle1" || className == "middle-section floor middle-section-toggle1 middle-section-toggle2") {
                $(".middle-section").addClass("middle-section-view");
            }
            else {
                $(".middle-section").removeClass("middle-section-view");
            }



            //            $('.m-right-btn').off('click');
            //            $('.m-left-btn').off('click');
            //            $('.m-left-btn').click(function () {
            //                $('.menu-bar').toggleClass('menu-bar-toggle');
            //                $('.m-left-btn').toggleClass('m-left-btn-toggle');
            //                $('.middle-section').toggleClass('middle-section-toggle1');

            //                var className = $('.middle-section').attr('class');

            //                if (className == "middle-section floor middle-section-toggle2 middle-section-toggle1" || className == "middle-section floor middle-section-toggle1 middle-section-toggle2") {
            //                    $(".middle-section").addClass("middle-section-view");
            //                }
            //                else {
            //                    $(".middle-section").removeClass("middle-section-view");
            //                }
            //            });

            //            $('.m-right-btn').click(function () {
            //                $('.manage-section').toggleClass('manage-section-toggle');
            //                $('.m-right-btn').toggleClass('m-right-btn-toggle');
            //                $('.middle-section').toggleClass('middle-section-toggle2');

            //                var className = $('.middle-section').attr('class');

            //                if (className == "middle-section floor middle-section-toggle2 middle-section-toggle1" || className == "middle-section floor middle-section-toggle1 middle-section-toggle2") {
            //                    $(".middle-section").addClass("middle-section-view");
            //                }
            //                else {
            //                    $(".middle-section").removeClass("middle-section-view");
            //                }
            //            });

            // Iterate over each select element
            $('.shiftStatus select').each(function () {

                // Cache the number of options
                var $this = $(this);
                numberOfOptions = $(this).children('option').length;

                // Hides the select element
                $this.addClass('s-hidden');

                // Wrap the select element in a div
                $this.wrap('<div class="select"></div>');

                // Insert a styled div to sit over the top of the hidden select element
                $this.after('<div class="styledSelect"></div>');

                // Cache the styled div
                var $styledSelect = $this.next('div.styledSelect');

                // Show the first select option in the styled div
                $styledSelect.text($this.children('option').eq(0).text());

                // Insert an unordered list after the styled div and also cache the list
                var $list = $('<ul />', {
                    'class': 'options'
                }).insertAfter($styledSelect);

                // Insert a list item into the unordered list for each select option
                for (var i = 0; i < numberOfOptions; i++) {
                    $('<li />', {
                        text: $this.children('option').eq(i).text(),
                        rel: $this.children('option').eq(i).val()
                    }).appendTo($list);
                }

                // Cache the list items
                var $listItems = $list.children('li');

                // Show the unordered list when the styled div is clicked (also hides it if the div is clicked again)
                $styledSelect.click(function (e) {
                    e.stopPropagation();
                    $('div.styledSelect.active').each(function () {
                        $(this).removeClass('active').next('ul.options').hide();
                    });
                    $(this).toggleClass('active').next('ul.options').toggle();
                });

                // Hides the unordered list when a list item is clicked and updates the styled div to show the selected list item
                // Updates the select element to have the value of the equivalent option
                $listItems.click(function (e) {
                    e.stopPropagation();
                    $styledSelect.text($(this).text()).removeClass('active');
                    $this.val($(this).attr('rel'));
                    $list.hide();
                    /* alert($this.val()); Uncomment this for demonstration! */
                });
                // Hides the unordered list when clicking outside of it
                $(document).click(function () {
                    $styledSelect.removeClass('active');
                    $list.hide();
                });
            });

            //            $(".listaMg").als({
            //                visible_items: 7,
            //                scrolling_items: 1,
            //                orientation: "horizontal",
            //                circular: "yes",
            //                autoscroll: "no",
            //                interval: 5000,
            //                direction: "right",
            //                start_from: 5
            //            });
            $("ul.reslist li").hover(function (e) {
                $(this).find(".frnt-right-popup").toggleClass("df");
            });

            $(".custom-select").each(function () {
                $(this).wrap("<span class='select-wrapper'></span>");
                $(this).after("<span class='holder'></span>");
            });
            $(".custom-select").change(function () {
                var selectedOption = $(this).find(":selected").text();
                $(this).next(".holder").text(selectedOption);
            });

        });
        function afterload() {
            $('.full-screen-view').click(function () {
                if ($('.full-screen-view').hasClass('normal-view')) {
                    $('.menu-bar').removeClass('menu-bar-toggle');
                    $('.m-left-btn').removeClass('m-left-btn-toggle');
                    //$('.middle-section').toggleClass('middle-section-toggle1');
                    $('.full-screen-view').removeClass('normal-view');
                    $('.manage-section').removeClass('manage-section-toggle');
                    $('.m-right-btn').removeClass('m-right-btn-toggle');
                    //$('.middle-section').toggleClass('middle-section-toggle2');
                    //$('.middle-section').toggleClass('middle-section-view');
                    SetMiddleWidthOnSideButtonClick();
                }
                else {
                    $('.menu-bar').addClass('menu-bar-toggle');
                    $('.m-left-btn').addClass('m-left-btn-toggle');
                    //$('.middle-section').toggleClass('middle-section-toggle1');
                    $('.full-screen-view').addClass('normal-view');
                    $('.manage-section').addClass('manage-section-toggle');
                    $('.m-right-btn').addClass('m-right-btn-toggle');
                    //$('.middle-section').toggleClass('middle-section-toggle2');
                    //$('.middle-section').toggleClass('middle-section-view');
                    SetMiddleWidthOnSideButtonClick();
                }
            });

            //            // Iterate over each select element
            //            $('select').each(function () {

            //                // Cache the number of options
            //                var $this = $(this);
            //                numberOfOptions = $(this).children('option').length;

            //                // Hides the select element
            //                $this.addClass('s-hidden');

            //                // Wrap the select element in a div
            //                $this.wrap('<div class="select"></div>');

            //                // Insert a styled div to sit over the top of the hidden select element
            //                $this.after('<div class="styledSelect"></div>');

            //                // Cache the styled div
            //                var $styledSelect = $this.next('div.styledSelect');

            //                // Show the first select option in the styled div
            //                $styledSelect.text($this.children('option').eq(0).text());

            //                // Insert an unordered list after the styled div and also cache the list
            //                var $list = $('<ul />', {
            //                    'class': 'options'
            //                }).insertAfter($styledSelect);

            //                // Insert a list item into the unordered list for each select option
            //                for (var i = 0; i < numberOfOptions; i++) {
            //                    $('<li />', {
            //                        text: $this.children('option').eq(i).text(),
            //                        rel: $this.children('option').eq(i).val()
            //                    }).appendTo($list);
            //                }

            //                // Cache the list items
            //                var $listItems = $list.children('li');

            //                // Show the unordered list when the styled div is clicked (also hides it if the div is clicked again)
            //                $styledSelect.click(function (e) {
            //                    e.stopPropagation();
            //                    $('div.styledSelect.active').each(function () {
            //                        $(this).removeClass('active').next('ul.options').hide();
            //                    });
            //                    $(this).toggleClass('active').next('ul.options').toggle();
            //                });

            //                // Hides the unordered list when a list item is clicked and updates the styled div to show the selected list item
            //                // Updates the select element to have the value of the equivalent option
            //                $listItems.click(function (e) {
            //                    e.stopPropagation();
            //                    $styledSelect.text($(this).text()).removeClass('active');
            //                    $this.val($(this).attr('rel'));
            //                    $list.hide();
            //                    GetShiftTime();
            //                    /* alert($this.val()); Uncomment this for demonstration! */
            //                });
            //                // Hides the unordered list when clicking outside of it
            //                $(document).click(function () {
            //                    $styledSelect.removeClass('active');
            //                    $list.hide();
            //                });
            //            });
            //            $(".listaMg").als({
            //                visible_items: 7,
            //                scrolling_items: 1,
            //                orientation: "horizontal",
            //                circular: "yes",
            //                autoscroll: "no",
            //                interval: 5000,
            //                direction: "right",
            //                start_from: 5
            //            });
            //            $("ul.reslist li").hover(function (e) {
            //                $(this).find(".frnt-right-popup").toggleClass("df");
            //            });
        }

        function BindSelectDesign(selector) {
            // Iterate over each select element
            $(selector).find('.styledSelect').remove();

            $(selector).find('select').each(function () {

                // Cache the number of options
                var $this = $(this);
                numberOfOptions = $(this).children('option').length;

                // Hides the select element
                $this.addClass('s-hidden');

                // Wrap the select element in a div
                $this.wrap('<div class="select"></div>');

                // Insert a styled div to sit over the top of the hidden select element
                $this.after('<div class="styledSelect"></div>');

                // Cache the styled div
                var $styledSelect = $this.next('div.styledSelect');

                // Show the first select option in the styled div
                $styledSelect.text($this.children('option').eq(0).text());

                // Insert an unordered list after the styled div and also cache the list
                var $list = $('<ul />', {
                    'class': 'options'
                }).insertAfter($styledSelect);

                // Insert a list item into the unordered list for each select option
                for (var i = 0; i < numberOfOptions; i++) {
                    $('<li />', {
                        text: $this.children('option').eq(i).text(),
                        rel: $this.children('option').eq(i).val()
                    }).appendTo($list);
                }

                // Cache the list items
                var $listItems = $list.children('li');

                // Show the unordered list when the styled div is clicked (also hides it if the div is clicked again)
                $styledSelect.click(function (e) {
                    e.stopPropagation();
                    $('div.styledSelect.active').each(function () {
                        $(this).removeClass('active').next('ul.options').hide();
                    });
                    $(this).toggleClass('active').next('ul.options').toggle();
                });

                // Hides the unordered list when a list item is clicked and updates the styled div to show the selected list item
                // Updates the select element to have the value of the equivalent option
                $listItems.click(function (e) {
                    //getCoversAndTime();
                    e.stopPropagation();
                    $styledSelect.text($(this).text()).removeClass('active');
                    $this.val($(this).attr('rel')).change();
                    $list.hide();
                    /* alert($this.val()); Uncomment this for demonstration! */
                });
                // Hides the unordered list when clicking outside of it
                $(document).click(function () {
                    $styledSelect.removeClass('active');
                    $list.hide();
                });
            });
        }

        function DesignCustomDropdowns() {
            $(".custom-select").each(function () {
                if ($(this).parents('.select-wrapper').length == 0) {
                    $(this).wrap("<span class='select-wrapper'></span>");
                    $(this).after("<span class='holder'></span>");
                    var selectedOption = $(this).find(":selected").text();
                    $(this).next(".holder").text(selectedOption);
                }
            });
            $(".custom-select").change(function () {
                var selectedOption = $(this).find(":selected").text();
                $(this).next(".holder").text(selectedOption);
            });
        }
    </script>
    @*<script type="text/javascript" src="/js/jquery.als-1.2.min.js"></script>*@
    <script type="text/javascript">
        $(document).ready(function () {
            Reservation('/Floor/ReservationList', null, null, null, null, "@ViewBag.ccshift");
            document.getElementById("aFloor").className = "active";

            if ("@ViewBag.ccfname" != "" && "@ViewBag.ccfname" != null) {
                Reservation('/Floor/ReservationAdd', "@ViewBag.ccfname", "@ViewBag.cclname", "@ViewBag.ccemail", "@ViewBag.ccphoneNo");
            }


            $("#cdate").datepicker({
                dateFormat: 'DD, d M, y'
            }).datepicker("setDate", "@ViewBag.ccdate");


            e = $("#cdate").val();
            var da = e.replace(',', '').split(' ');
            $(".date").text(da[1]);
            $(".day").text(da[0].substring(0, 3));
            $(".month").text(da[2]);

            // bind shift li click get time 
            $(".shiftStatus li").click(function () {
                GetShiftTime();
            })

        });

        function changeCdate(e) {
             
            e = $(e).val();
            var da = e.replace(',', '').split(' ');
            $(".date").text(da[1]);
            $(".day").text(da[0].substring(0, 3));
            $(".month").text(da[2]);

            GetShiftTime();
        }

        function validNumber(e) {
            if (e.shiftKey || e.ctrlKey || e.altKey) {
                e.preventDefault();
            } else {
                var key = e.keyCode;
                if (key != 9) {
                    if (!((key == 8) || (key == 46) || (key >= 35 && key <= 40) || (key >= 48 && key <= 57) || (key >= 96 && key <= 105))) {
                        e.preventDefault();
                    }
                }
            }
        }

        function save() {
            //var validEmail = true;
            //if ($("#Email").val() != "") {
            //    var $email = $("#Email").val();
            //    var emailReg = @(Html.Raw("/^([\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4})?$/;"));
            //    if (!emailReg.test($email)) {
            //        validEmail = false;
            //    }
            //}

            if ($("#cdate").val() == "") {
                alert("Please select date.");
            }
            else if ($("#FirstName").val() == "") {
                alert("Please enter First Name.");
            } else if ($("#LastName").val() == "") {
                alert("Please enter Last Name.");
            } else if ($("#shift").next().text() == "") {
                alert("Please select Shift.");
            } else if ($("#MobileNumber").val() == "") {
                alert("Please enter Mobile Number.");
            }
            //            else if ($("#Email").val() == "" || validEmail == false) {
            //                alert("Please enter valid Email.");
            //            }
            else if ($("#Covers").val() == "") {
                alert("Please enter Cover.");
            } else if ($('#open :selected').val() == "" || $('#open :selected').val() == undefined) {
                alert("Please select time.");
            }
            else if ($('#table :selected').val() == "" || $('#table :selected').val() == undefined) {
                alert("Please select table.");
            }
            else {
                $.ajax({
                    url: '/Floor/ReservationSave',
                    data: {
                        date: $("#cdate").val(),
                        fname: $("#FirstName").val(),
                        lname: $("#LastName").val(),
                        shift: $("#shift").next().text(),
                        mobileNo: $("#MobileNumber").val(),
                        email: $("#Email").val(),
                        cover: $("#Covers").val(),
                        time: $("#open").val(),
                        tableId: $("#table").val(),
                        floorId: '@(Model.FloorPlanId)',
                        TopTablePosition: $(".table-main #FloorTableId[value='" + ($("#table").val()) + "']").parents('.table-main').css('top'),
                        LeftTablePosition: $(".table-main #FloorTableId[value='" + ($("#table").val()) + "']").parents('.table-main').css('left')
                    },
                    success: function () {
                        Reservation('/Floor/ReservationList');
                    }
                });
            }
        }

        function Reservation(url, fname, lname, email, phno, shift) {
            $.ajax({
                url: url,
                success: function (data) {
                    $("#rightContent").html(data);
                    afterload();
                    $("#tabs").tabs();
                    scrollscroll();
                    scrollscroll();

                    if (fname != "" && fname != undefined && lname != "" && lname != undefined && lname != "" && phno != "" && phno != undefined) {
                        $("#FirstName").val(fname);
                        $("#LastName").val(lname);
                        $("#MobileNumber").val(phno);
                        $("#Email").val(email);
                        GetAdditionalDetail();
                    }

                    if ($(".add-new-reser.form").length == 1) {
                        GetShiftTime();
                        $('#MobileNumber').keydown(function (e) {
                            validNumber(e);
                        });
                    } else {
                        getUserList();
                    }

                    if (shift != null) {
                        $(".shiftStatus ul li").each(function (a, p) {
                            if ($(p).text() == shift) {
                                $(p).click();
                            }
                        });
                    }
                }
            });

        }
//        function coverFilter(e) {
//            cls = $(e).text() + "cover";
//            $("#tabs-1 .reslist").children('li').hide();
//            $("." + cls).show();
//        }

        function getUserList(status) {
            if ($("#cdate").val() != "" && $("#cdate").val() != undefined && '@(Model.FloorPlanId)' != "" && $("#shift").next().text() != "" && $("#shift").next().text() != undefined) {
                $.ajax({
                    data: { date: $("#cdate").val(), FloorPlanId: '@(Model.FloorPlanId)', shift: $("#shift").next().text(), status: status },
                    url: '/Floor/GetReservationUser',
                    success: function (data) {
                        var ht = "";
                        $.each(data, function (b, z) {
                            ht += "<li id='resL" + z.resId + "' class=" + (z.Covers + 'cover') + " data-cover='" + z.Covers + "' data-time='" + z.time + "'><a rel='#resPopUpTTip" + z.resId + "' href='javascript:void(0)' class='jt' style='cursor: pointer;'><p><span>" + z.Covers + "</span></p><p><span><strong>" + z.name + "</strong><br>" + z.time + "</span></p><p><span>" + z.TableName + "</span></p><p><img src='/images/" + z.status + ".png'></p>" + z.popUp + "</a></li>";
                        });

                        $("#tabs-1 .reslist").html(ht);

                        //                        $("#tabs-1 ul.reslist li").click(function (e) {
                        //                            $("li div.frnt-right-popup").removeClass("df");
                        //                            $(this).find(".frnt-right-popup").toggleClass("df");
                        //                        });

                        //BindSelectDesign("#tabs-1 ul.reslist");
                        DesignCustomDropdowns();

                        $('a.jt').cluetip({
                            cluetipClass: 'jtip',
                            arrows: true,
                            dropShadow: false,
                            width: 352,
                            sticky: true,
                            mouseOutClose: true,
                            local: true,
                            multiple: false,
                            cursor: 'pointer',
                            ajaxCache: false,
                            attribute: 'rel',
                            closePosition: 'none'
                        });
                    }
                });
                getWaitingUserList();
            }
            $('#floorArea').load('@(Url.Action("_FloorPlanPartial", "Floor"))', { startTime: $("#cdate").val(), shift: $("#shift").next().text() }, function () {
                $(".quan-2-other1,.quan-2-1,.quan-4-1").click(function (e) {
                    $('.table-main').css('z-index', '');
                    var position = $(this).parents('.table-main').position();

                    if (position.left < 512) {
                        $(this).parents('.table-main').css('z-index', 9999).find('.show-tooltip-left').css('left', '100%').css('right', '');
                    }
                    else {
                        $(this).parents('.table-main').css('z-index', 9999).find('.show-tooltip-left').css('left', '').css('right', '100%');
                    }

                    $('.show-tooltip-left').not($(this).parents('.table-main').find('.show-tooltip-left')).removeClass('show-tooltip-left-toggle');
                    $(this).parents('.table-main').find('.show-tooltip-left').toggleClass('show-tooltip-left-toggle');

                    //BindScroll($(this).parents('.table-main'));
                });

                BindSelectDesign('#floorArea');

                SetRotateToFloorItems();
                ReservationListEvent();
                AssignSectionSlider();
            });
        }

        function GetShiftTime() {
            if ($(".add-new-reser.form").length == 1) {
                if ($("#cdate").val() != "" && $("#cdate").val() != undefined && '@(Model.FloorPlanId)' != "" && $("#shift").next().text() != "" && $("#shift").next().text() != undefined) {
                    $.ajax({
                        data: { date: $("#cdate").val(), FloorPlanId: '@(Model.FloorPlanId)', shift: $("#shift").next().text() },
                        url: '/Reservation/GetShiftTime',
                        success: function (data) {
                            $("#open").html('');
                            $("#open").append($("<option></option>").val('').html('-Select-'));
                            $.each(data.ttime, function (b, z) {
                                $("#open").append($("<option></option>").val(z.Value).html(z.Text));
                            });
                            $(".covStatus .sc").text(data.Count);
                        }
                    });
                }
            }
            else {
                getUserList();
            };
        }
        //get tables Based On date Shift

        function getTable() {
            if ($("#cdate").val() != "" && '@(Model.FloorPlanId)' != "" && $("#shift").next().text() != "" && $('#open :selected').val() != "") {
                $.ajax({
                    data: { date: $("#cdate").val(), FloorPlanId: '@(Model.FloorPlanId)', shift: $("#shift").next().text(), time: $('#open :selected').val() },
                    url: '/Reservation/getTables',
                    success: function (data) {
                        $('#tcount').text(data.length + " tables ");

                        $("#table").html('');
                        $.each(data, function (p, a) {
                            $("#table").append($("<option></option>").val(a.id).html(a.name));
                        });

                        $('#floorArea').load('@(Url.Action("UpdateFloorPlan", "Floor"))', { date: $("#cdate").val(), time: $('#open :selected').val(), shift: $("#shift").next().text() }, function () {
                            $(".quan-2-other1,.quan-2-1,.quan-4-1").click(function (e) {
                                $('.table-main').css('z-index', '');

                                var position = $(this).parents('.table-main').position();

                                if (position.left < 512) {
                                    $(this).parents('.table-main').css('z-index', 9999).find('.show-tooltip-left').css('left', '100%').css('right', '');
                                }
                                else {
                                    $(this).parents('.table-main').css('z-index', 9999).find('.show-tooltip-left').css('left', '').css('right', '100%');
                                }

                                $('.show-tooltip-left').not($(this).parents('.table-main').find('.show-tooltip-left')).removeClass('show-tooltip-left-toggle');
                                $(this).parents('.table-main').find('.show-tooltip-left').toggleClass('show-tooltip-left-toggle');
                                //BindScroll($(this).parents('.table-main'));
                            });

                            BindSelectDesign('#floorArea');

                            SetRotateToFloorItems();
                            ReservationListEvent();
                            AssignSectionSlider();
                        });
                    }
                });
            }
        }

        function scrollscroll() {
            $(".content_1").mCustomScrollbar();
            $(".content_1").mCustomScrollbar({ updateOnContentResize: true });
        }



        function getWaitingUserList() {

            var currentTime = localtime;

            if (currentTime != null && currentTime != undefined && $("#cdate").val() != "" && $("#cdate").val() != undefined && '@(Model.FloorPlanId)' != "" && $("#shift").next().text() != "" && $("#shift").next().text() != undefined) {
                $.ajax({
                    data: { seletedDate: $("#cdate").val(), date: currentTime.toUTCString(), FloorPlanId: '@(Model.FloorPlanId)', shift: $("#shift").next().text() },
                    url: '/Floor/GetWaitingUsers',
                    success: function (data) {
                        var ht = "";
                        $.each(data, function (b, z) {
                            ht += "<li><a rel='#resPopUpTTip" + z.resId + "' href='javascript:void(0)' class='jt' style='cursor: pointer;'><p><span>" + z.Covers + "</span></p><p><span><strong>" + z.name + "</strong><br>" + z.time + "</span></p><p><span>" + z.TableName + "</span></p><p><img src='/images/call-active.png'></p>" + z.popUp + "</a></li>";
                        });
                        $("#tabs-2 .reslist").html(ht);

                        $("#tabs-2 ul.reslist li").hover(function (e) {
                            $(this).find(".frnt-right-popup").toggleClass("df");
                        });

                        //BindSelectDesign("#tabs-2 ul.reslist");
                        DesignCustomDropdowns();

                        $('a.jt').cluetip({
                            cluetipClass: 'jtip',
                            arrows: true,
                            dropShadow: false,
                            width: 352,
                            sticky: true,
                            mouseOutClose: true,
                            local: true,
                            multiple: false,
                            cursor: 'pointer',
                            ajaxCache: false,
                            attribute: 'rel',
                            closePosition: 'none'
                        });
                    }
                });
            }
        }

        //        function getStaffList() {
        //            if ($("#cdate").val() != "" && $("#cdate").val() != undefined && '@(Model.FloorPlanId)' != "" && $("#shift").next().text() != "" && $("#shift").next().text() != undefined) {
        //                $.ajax({
        //                    data: { date: $("#cdate").val(), FloorPlanId: '@(Model.FloorPlanId)', shift: $("#shift").next().text() },
        //                    url: '/Floor/GetReservationUser',
        //                    success: function (data) {
        //                        var ht = "";
        //                        $.each(data, function (b, z) {
        //                            ht += "<li><p><span>" + z.Covers + "</span></p><p><span><strong>" + z.name + "</strong><br>" + z.time + "</span></p><p><span>" + z.TableName + "</span></p><p><img src='/images/call-active.png'></p>" + z.popUp + "</li>";
        //                        });
        //                        $("#tabs-1 .reslist").html(ht);

        //                        $("ul.reslist li").hover(function (e) {
        //                            $(this).find(".frnt-right-popup").toggleClass("df");
        //                        });

        //                        BindSelectDesign("ul.reslist");
        //                    }
        //                });
        //            }

        //            $('#floorArea').load('@(Url.Action("_FloorPlanPartial", "Floor"))', { startTime: $("#cdate").val(), shift: $("#shift").next().text() }, function () {
        //                $(".quan-2-other1,.quan-2-1,.quan-4-1").click(function (e) {
        //                    $('.table-main').css('z-index', '');
        //                    var position = $(this).parents('.table-main').position();

        //                    if (position.left < 512) {
        //                        $(this).parents('.table-main').css('z-index', 9999).find('.show-tooltip-left').css('left', '100%').css('right', '');
        //                    }
        //                    else {
        //                        $(this).parents('.table-main').css('z-index', 9999).find('.show-tooltip-left').css('left', '').css('right', '100%');
        //                    }

        //                    $('.show-tooltip-left').not($(this).parents('.table-main').find('.show-tooltip-left')).removeClass('show-tooltip-left-toggle');
        //                    $(this).parents('.table-main').find('.show-tooltip-left').toggleClass('show-tooltip-left-toggle');
        //                });

        //                BindSelectDesign('#floorArea');

        //                $(".listaMg").als({
        //                    visible_items: 7,
        //                    scrolling_items: 1,
        //                    orientation: "horizontal",
        //                    circular: "yes",
        //                    autoscroll: "no",
        //                    interval: 5000,
        //                    direction: "right",
        //                    start_from: 5
        //                });
        //            });
        //        }

        function getUpcomingUserList(url) {
            $("#tabs-1 .reslist").load(url, function (data) {

            });
        }
    </script>
    <script type="text/javascript">

        var timeSlide;
        var timeSlidePaused = true;

        $(document).ready(function () {

            //************ Drag & Drop tables on floor *************//

            $("#floorArea").droppable();

            $("#floorArea .table-main").live('mouseover', function () {
                $(this).draggable({
                    containment: '#floorArea',
                    cancel: ".table-main .show-tooltip-left"
                });
            });


            //*************  *****************//
            $("#floorArea .quan-2-other1,.quan-2-1,.quan-4-1").live('click', function (e) {
                e.stopPropagation();
                $(".quan-2-other1,.quan-2-1,.quan-4-1").removeClass("secHover");
                $(this).addClass("secHover");
                //clearInterval(t);
                //$(this).parents(".table-main").find(".rotate").show();

            });

            $("#floorArea").live('click', function () {
                $(".seat,.quan-2-other1,.quan-2-1,.quan-4-1,.item img").removeClass("secHover");
                $('.show-tooltip-left').removeClass('show-tooltip-left-toggle');
                $(".frnt-right-popup").removeClass("df");
            });

            $('.dateStatus').click(function () {
                $('#cdate').datepicker("show");
            });

            $('.top-bar ul li a').click(function () {
                $.ajax({
                    data: { floorPlanId: +$(this).next().val() },
                    url: '/Floor/updateFloorActive',
                    success: function (data) {
                        window.location.reload();
                    }
                });


                // var $FloorArrow = $('#flrArrow');
                // $('#flrArrow').remove();
                $('.top-bar ul li a').removeClass('active');
                $(this).addClass('active');
                // $(this).parent().append($FloorArrow);

            });

            /***** Time Slider ****/

            var $slideMe = $("<div/>")
            .css({ position: 'absolute', top: 30, left: 0, border: '1px solid #E8867C', background: '#E8867C', color: '#FFFFFF', padding: '3px', 'border-radius': '2px' })
            .text("04:00")
            .hide();

            $("#slider").slider({
                min: 0,
                max: 1425, // 4AM to 3:45AM = 1425 min
                step: 15,
                value: 240, // 4AM
                slide: function (event, ui) {
                    var hours = Math.floor(ui.value / 60) < 10 ? '0' + Math.floor(ui.value / 60) : Math.floor(ui.value / 60);
                    var minutes = (ui.value % 60) < 10 ? '0' + (ui.value % 60) : (ui.value % 60);

                    $("#sldTime").text(hours + ':' + minutes);
                    $slideMe.text(hours + ':' + minutes);
                },
                change: function (event, ui) {
                    if (event.originalEvent === undefined) {
                        var hours = Math.floor(ui.value / 60) < 10 ? '0' + Math.floor(ui.value / 60) : Math.floor(ui.value / 60);
                        var minutes = (ui.value % 60) < 10 ? '0' + (ui.value % 60) : (ui.value % 60);

                        $("#sldTime").text(hours + ':' + minutes);
                        UpdateDataOnTimeChange(hours + ':' + minutes);
                    }
                    else {
                        if (!timeSlidePaused) {
                            if (confirm('Do you want to stop automatic refresh of floor plan?')) {
                                StopSlideTimer();
                            }
                        }
                    }
                },
                stop: function (event, ui) {
                    var hours = Math.floor(ui.value / 60) < 10 ? '0' + Math.floor(ui.value / 60) : Math.floor(ui.value / 60);
                    var minutes = (ui.value % 60) < 10 ? '0' + (ui.value % 60) : (ui.value % 60);

                    $("#sldTime").text(hours + ':' + minutes);
                    UpdateDataOnTimeChange(hours + ':' + minutes);
                }
            })
            .find(".ui-slider-handle")
            .append($slideMe)
            .hover(function () {
                $slideMe.show();
            },
            function () {
                $slideMe.stop().hide();
            });

            SlideTime(true);

            StartSlideTimer();
        });

        function SlideTime(isPageRefresh) {
            // 
            var now = new Date();
            now = (now.getHours() * 60) + now.getMinutes();

            //alert(now);

            if ((now % 15) == 0) {
                $("#slider").slider({ value: now });
            }
            else if (isPageRefresh) {
                var timeDiff = (now % 15);
                now = now - timeDiff;
                $("#slider").slider({ value: now });
            }
        }

        function StartSlideTimer() {
            timeSlide = setInterval(function () { SlideTime(false); }, 30000);
            timeSlidePaused = false;
        }

        function StopSlideTimer() {
            clearInterval(timeSlide);
            timeSlidePaused = true;
        }

        /*******************/

        function EditTable(e) {
            return false;
        }

        function UpdateDataOnTimeChange(time) {

            UpdateFloorPlanWithTime(time);
            UpdateReservationList(time);
        }

        function UpdateFloorPlanWithTime(time) {
            $('#floorArea').load('@(Url.Action("UpdateFloorPlanOnTimeSlide", "Floor"))', { date: $("#cdate").val(), time: time }, function () {
                $(".quan-2-other1,.quan-2-1,.quan-4-1").click(function (e) {
                    $('.table-main').css('z-index', '');

                    var position = $(this).parents('.table-main').position();

                    if (position.left < 512) {
                        $(this).parents('.table-main').css('z-index', 9999).find('.show-tooltip-left').css('left', '100%').css('right', '');
                    }
                    else {
                        $(this).parents('.table-main').css('z-index', 9999).find('.show-tooltip-left').css('left', '').css('right', '100%');
                    }

                    $('.show-tooltip-left').not($(this).parents('.table-main').find('.show-tooltip-left')).removeClass('show-tooltip-left-toggle');
                    $(this).parents('.table-main').find('.show-tooltip-left').toggleClass('show-tooltip-left-toggle');

                    //BindScroll($(this).parents('.table-main'));
                });

                BindSelectDesign('#floorArea');

                SetRotateToFloorItems();
                ReservationListEvent();
                AssignSectionSlider();
            });
        }

        function UpdateReservationList(time) {
            if ($("#cdate").val() != "" && $("#cdate").val() != undefined && '@(Model.FloorPlanId)' != "" && time != null) {
                $.ajax({
                    data: { date: $("#cdate").val(), FloorPlanId: '@(Model.FloorPlanId)', time: time },
                    url: '/Floor/GetReservationUser',
                    success: function (data) {
                        var ht = "";
                        $.each(data, function (b, z) {
                            ht += "<li id='resL" + z.resId + "' class=" + (z.Covers + 'cover') + " data-cover='" + z.Covers + "' data-time='" + z.time + "'><a rel='#resPopUpTTip" + z.resId + "' href='javascript:void(0)' class='jt' style='cursor: pointer;'><p><span>" + z.Covers + "</span></p><p><span><strong>" + z.name + "</strong><br>" + z.time + "</span></p><p><span>" + z.TableName + "</span></p><p><img src='/images/call-active.png'></p>" + z.popUp + "</a></li>";
                        });
                        $("#tabs-1 .reslist").html(ht);

                        //                        $("#tabs-1 ul.reslist li").click(function (e) {
                        //                            $("li div.frnt-right-popup").removeClass("df");
                        //                            $(this).find(".frnt-right-popup").toggleClass("df");
                        //                        });

                        //BindSelectDesign("#tabs-1 ul.reslist");
                        DesignCustomDropdowns();

                        $('a.jt').cluetip({
                            cluetipClass: 'jtip',
                            arrows: true,
                            dropShadow: false,
                            width: 352,
                            sticky: true,
                            mouseOutClose: true,
                            local: true,
                            multiple: false,
                            cursor: 'pointer',
                            ajaxCache: false,
                            attribute: 'rel',
                            closePosition: 'none'
                        });
                    }
                });
            }

        }

        function SetRotateToFloorItems() {
            $('.table').each(function (index, element) {

                if ($(this).parents('.c-container').length > 0) {
                    var angle = $(this).parents('.table-main').find('#Angle').val();
                    $(this).parents('.table-main').css({
                        '-moz-transform': 'rotate(' + (angle) + 'deg)',
                        '-webkit-transform': 'rotate(' + (angle) + 'deg)',
                        '-o-transform': 'rotate(' + (angle) + 'deg)',
                        '-ms-transform': 'rotate(' + (angle) + 'deg)'
                    });

                    SetRotateToTableSeats(this);
                }
                else {
                    var angle = $(this).find('#Angle').val();
                    $(this).css({
                        '-moz-transform': 'rotate(' + (angle) + 'deg)',
                        '-webkit-transform': 'rotate(' + (angle) + 'deg)',
                        '-o-transform': 'rotate(' + (angle) + 'deg)',
                        '-ms-transform': 'rotate(' + (angle) + 'deg)'
                    });
                }
            });
        }

        function SetRotateToTableSeats(table) {
            // 
            var seatCount = $(table).parents('.table-main').find('.seat').length;
            var angle = (360 / seatCount);
            var sumAngl = 0;

            for (var n = 0; n < seatCount; n++) {

                $(table).parents('.table-main').find(".seat" + n).css({
                    '-moz-transform': 'rotate(' + (sumAngl) + 'deg)',
                    '-webkit-transform': 'rotate(' + (sumAngl) + 'deg)',
                    '-o-transform': 'rotate(' + (sumAngl) + 'deg)',
                    '-ms-transform': 'rotate(' + (sumAngl) + 'deg)'
                });

                sumAngl = sumAngl + angle;
            }
        }
    </script>
    <script src="../../js/lemmon-slider.js" type="text/javascript"></script>
    <script type="text/javascript">
        window.onload = function () {

            // slider 1
            $('#topslider1').lemmonSlider({
                infinite: false
            });
            $('#bottomslider2').lemmonSlider({
                infinite: false
            });
        }


        function AssignSectionSlider() {
            $('#topslider1').lemmonSlider('destroy').lemmonSlider({
                infinite: false
            });
        }
	
    </script>
}
<div class="middle-section floor floorSize">
    <div class="top-bar">
        <div style="float: left; margin-top: 8px; margin-left: 15px; width: auto;">
            TIME</div>
        <div id="slider" style="float: left; margin-top: 8px; margin-left: 15px; width: calc(100% - 140px);">
        </div>
        <div id="sldTime" style="background: none repeat scroll 0 0 #FFFFFF; float: left;
            margin-left: 12px; margin-top: 8px; padding: 3px; width: 36px;">
            TIME</div>
    </div>
    <div class="top-bar" style="position: relative;">
        <div class="nav">
            <div id="bottomslider2" class="slider">
                <ul>
                    @foreach (var item in ViewBag.Floors)
                    {
                        <li><a class="@(item.IsActive ? "active" : string.Empty)" href="javascript:void(0)">@item.FloorName</a>
                            <input type="hidden"  value="@item.FloorPlanId"/>
                        </li>
                    }
                </ul>
            </div>
            <div class="controls">
                <a href="#" class="prev-slide">Prev Slide</a> <a href="#" class="next-slide">Next Slide</a>
            </div>
        </div>
        <ul class="top-view-btn"
            <li class="toggle-btn"></li>
            <li class="full-screen-view"></li>
        </ul>
    </div>
    <div id="floorArea" class="table-flow" style="width: 100%; height: 768px; z-index: 1;">
        @Html.Action("_FloorPlanPartial")
    </div>
</div>
<div class="manage-section"  >
    <div class="m-right-btn">
    </div>
    <div class="frnt-right-rowA">
        <ul class="frst">
            <li>
                <div class="dateStatus">
                    <span class="date"></span><span class="day"></span><span class="month"></span>
                    <input onchange="changeCdate(this)" type="text" id="cdate" style="background: #585F68;
                        color: #585F68;" />
                </div>
            </li>
            <li>
                <div class="shiftStatus">
                    <span class="sft">Shift</span>
                    @Html.DropDownList("shift", new SelectList(new string[] { "All", "Breakfast", "Brunch", "Lunch", "Dinner" }))
                </div>
            </li>
            <li>
                <div class="covStatus">
                    <span class="fs">Covers</span> <span class="sc"></span>
                </div>
            </li>
        </ul>
    </div>
    <div id="rightContent">
    </div>
</div>
