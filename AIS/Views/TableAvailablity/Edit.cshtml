@model AIS.Models.TableAvailablity.EditAvailVM
@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_LayoutBase.cshtml";
}
@section styles
{
    <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css" />
    <style type="text/css">
        /*------------ 26-06-2014 ----------*/

        .ta-search-main {
            float: right;
            width: 110px;
            margin: 10px 0 0 0;
        }

        .ta-search-edithd {
            float: right;
            width: auto;
            margin: 15px 10px 0 0;
            font-size: 24px;
            line-height: 24px;
            font-weight: 400;
            color: #000;
        }

        .ta-search-main p {
            float: left;
            width: 34px;
            line-height: 45px;
        }

        .ta-search-main .onoffswitch {
            width: 60px;
        }

        .ta-search-main .onoffswitch-inner:before, .ta-search-main .onoffswitch-inner:after {
            background: #4fc1e9;
            color: #fff;
        }

        .ta-search-main .onoffswitch-switch {
            right: 30px;
        }

        .ta-main {
            float: left;
            width: 100%;
            height: auto;
        }

            .ta-main ul {
                float: left;
                width: 100%;
                height: auto;
                margin: 0px;
                padding: 0px;
            }

                .ta-main ul li {
                    float: left;
                    width: 100%;
                    height: auto;
                    margin: 0px;
                    padding: 19px 0;
                    border-bottom: 1px solid #cecece;
                }

            .ta-main .ta-col-a {
                float: left;
                width: 201px;
                height: auto;
                font-size: 16px;
                color: #000000;
                font-weight: 400;
                box-sizing: border-box;
                -webkit-box-sizing: border-box;
                padding: 0 0 0 38px;
            }

            .ta-main .range-date {
                float: left;
                width: 130px;
                height: auto;
            }

                .ta-main .range-date label {
                    float: left;
                    width: 100%;
                    font-size: 15px;
                    color: #959595;
                    font-weight: 400;
                }

                .ta-main .range-date .date-picker {
                    width: 140px;
                    float: left;
                    margin: 3px 10px 0 0;
                }

                    .ta-main .range-date .date-picker input[type="text"] {
                        width: 119px;
                        float: left;
                        border: solid 1px #eaeaea;
                        overflow: hidden;
                        border-radius: 5px;
                        padding: 12px 0 12px 11px;
                        color: #626262;
                        font-weight: 500;
                        font-size: 13px;
                        font-family: 'Lato', sans-serif;
                        text-align: left;
                        background: url("../images/cal-icon.png") no-repeat scroll 90% 50% rgba(0, 0, 0, 0);
                        border-radius: 5px;
                        -webkit-border-radius: 5px;
                        -moz-border-radius: 5px;
                        -o-border-radius: 5px;
                        box-shadow: 0 3px 0px #cfcfcf;
                        -webkit-box-shadow: 0 3px 0px #cfcfcf;
                        -moz-box-shadow: 0 3px 0px #cfcfcf;
                        -o-box-shadow: 0 3px 0px #cfcfcf;
                        box-sizing: border-box;
                        -webkit-box-sizing: border-box;
                        -moz-box-sizing: border-box;
                    }

        .sel-m {
            float: left;
            width: 109px;
            height: 50px;
            margin-left: 10px;
        }

            .sel-m label {
                float: left;
                width: 100%;
                font-size: 15px;
                color: #959595;
                font-weight: 400;
            }

        .ta-main .select-main {
            width: 109px;
            height: 40px;
            float: left;
            border: solid 1px #c1c1c1;
            overflow: hidden;
            background: url("../images/select-arrow.png") no-repeat scroll 88% 50% rgba(0, 0, 0, 0);
            border-radius: 5px;
            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            -o-border-radius: 5px;
            box-shadow: 0 2px 0px #cfcfcf;
            -webkit-box-shadow: 0 2px 0px #cfcfcf;
            -moz-box-shadow: 0 2px 0px #cfcfcf;
            -o-box-shadow: 0 2px 0px #cfcfcf;
            box-sizing: border-box;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
        }

        .ta-main select {
            color: #626262;
            width: 120%;
            height: 40px;
            font-weight: 500;
            font-size: 16px;
            float: left;
            padding: 9px 0 5px 7px;
            font-family: 'Lato', sans-serif;
            background: none;
            border: none;
        }

        .ta-main .row-check {
            float: left;
            width: 665px;
            height: auto;
        }

        .ta-main .row-check {
            font-size: 16px;
            line-height: 26px;
        }

            .ta-main .row-check .col-check-mian {
                float: left;
                width: 166px;
                height: auto;
            }

            .ta-main .row-check .col-check {
                float: left;
                width: 157px;
                height: auto;
                margin-bottom: 5px;
            }

                .ta-main .row-check .col-check .custom_check {
                    float: left;
                    width: auto;
                }

                .ta-main .row-check .col-check label {
                    float: left;
                    width: 120px;
                    color: #6e6e6e;
                    margin: 0 0 0 10px;
                    font-size: 15px;
                    line-height: 26px;
                }

            .ta-main .row-check .col-check-mianb {
                float: left;
                width: 93px;
                height: auto;
            }

            .ta-main .row-check .col-checkb {
                float: left;
                width: 89px;
                height: auto;
                margin-bottom: 5px;
            }

                .ta-main .row-check .col-checkb .custom_check {
                    float: left;
                    width: auto;
                }

                .ta-main .row-check .col-checkb label {
                    float: left;
                    width: 50px;
                    color: #6e6e6e;
                    margin: 0 0 0 10px;
                    font-size: 15px;
                    line-height: 26px;
                }


            .ta-main .row-check a.showall {
                float: right;
                width: auto;
                height: auto;
                font-size: 13px;
                margin-right: 10px;
                color: #e8867c;
                transition: all .2s;
                -webkit-transition: all .2s;
            }

                .ta-main .row-check a.showall:hover {
                    color: #000;
                }

            .ta-main .row-check .buttons {
                float: left;
                width: 100%;
                height: auto;
                text-align: right;
            }

                .ta-main .row-check .buttons input[type="button"] {
                    color: #373a42;
                    font-weight: 500;
                    font-size: 16px;
                    float: right;
                    padding: 4px 12px 5px;
                    margin-right: 12px;
                    font-family: 'Lato', sans-serif;
                    background: #fff;
                    cursor: pointer;
                    border: solid 1px #e8867c;
                    border-radius: 5px;
                    -webkit-border-radius: 5px;
                    -moz-border-radius: 5px;
                    -o-border-radius: 5px;
                    transition: all 0.3s ease-Out;
                    -webkit-transition: all 0.3s ease-Out;
                    -moz-transition: all 0.3s ease-Out;
                    -o-transition: all 0.3s ease-Out;
                }

                .ta-main .row-check .buttons input:hover[type="button"] {
                    color: #fff;
                    background: #e8867c;
                }
    </style>
}
@section scripts
{
    <script type="text/javascript">
        $(function () {
            $("#StartDateEdit").datepicker({
                dateFormat: 'mm/dd/yy',
                onClose: function (selected) {
                    $("#EndDateEdit").datepicker("option", "minDate", selected);
                }
            });

            $("#EndDateEdit").datepicker({
                dateFormat: 'mm/dd/yy',
                onClose: function (selected) {
                    $("#StartDateEdit").datepicker("option", "maxDate", selected);
                }
            });

            $("#StartDateEdit").datepicker("show").datepicker("hide");
            $("#EndDateEdit").datepicker("show").datepicker("hide");
        });
    </script>
    <script src="../../js/jquery.screwdefaultbuttonsV2.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.custom_check').screwDefaultButtons({
                image: "url(/images/checkbox.png)",
                width: 24,
                height: 24
            });

            $('#all').change(function (event) {  //on click
                if (this.checked) { // check select status
                    $('input[name = selectedTables]').filter(':not(:checked)').click();
                } else {
                    $('input[name = selectedTables]').filter(':checked').click();
                }
            });

            $('#allDays').change(function (event) {  //on click
                if (this.checked) { // check select status
                    $('input[name = selectedWeekDays]').filter(':not(:disabled)').filter(':not(:checked)').click();
                } else {
                    $('input[name = selectedWeekDays]').filter(':not(:disabled)').filter(':checked').click();
                }
            });

            $('input[name = selectedAvailability]').change(function () {
                if (this.checked) {
                    //$('input[name = selectedAvailability]').filter(':checked').not(this).prop('checked', false).parent().removeClass('checked').css('background', 'url("/images/checkbox_Unchecked.png")');
                    $('input[name = selectedAvailability]').filter(':checked').not(this).click();
                }
            });

            $('input').change(function () {
                UpdateBottomText();
            });

            $('#edtTATimeRange select[name = StartTime], #edtTATimeRange select[name = EndTime]').change(function () {
                UpdateBottomText();
            });

            UpdateBottomText();

            setTimeout(function () {
                $('.middle-section').css('height', 'auto');
            }, 500);
        });

        $('#formEdit').submit(function () {
            if ($('input[name = selectedTables]').filter(':checked').length == 0) {
                alert("Please select atleast one table before saving.");
                return false;
            }

            if ($('input[name = selectedWeekDays]').filter(':checked').length == 0) {
                alert("Please select atleast one week day before saving.");
                return false;
            }

            if ($('input[name = selectedAvailability]').filter(':checked').length == 0) {
                alert("Please select an availability status before saving.");
                return false;
            }
        });

        function UpdateBottomText() {
            //debugger;
            var html = "";

            if ($('input[name = selectedTables]').filter(':checked').length > 0) {
                var checkedTables = $('input[name = selectedTables]').filter(':checked');
                var length = checkedTables.length;
                var tblNames = "";

                checkedTables.each(function (index) {
                    if (length == 1) {
                        tblNames += $(this).attr('id');
                    }
                    else {
                        if (index < (length - 1)) {
                            tblNames += $(this).attr('id') + ", ";
                        }
                        else {
                            tblNames += $(this).attr('id');
                            tblNames.length = (tblNames.length - 2);
                        }
                    }
                });

                html += "<p>" +
                                "<strong>Table</strong> " + tblNames + "</p>";


                //debugger;
                if ($.trim($('#StartDate').val()) != "" && $.trim($('#EndDate').val()) != "") {
                    html += "<p>" +
                                "<strong>From</strong> " + $.datepicker.formatDate('DD, d MM, yy', $('#StartDateEdit').datepicker('getDate')) + " <strong>Until</strong> " + $.datepicker.formatDate('DD, d MM, yy', $('#EndDateEdit').datepicker('getDate')) + "</p>";
                }

                if ($('input[name = selectedWeekDays]').filter(':checked').length > 0) {
                    var length = $('input[name = selectedWeekDays]').filter(':checked').length;
                    var weekDays = "";

                    $('input[name = selectedWeekDays]').filter(':checked').each(function (index) {
                        if (length == 1) {
                            weekDays += $(this).attr('id') + "(s)";
                        }
                        else {
                            if (index < (length - 1)) {
                                weekDays += $(this).attr('id') + "(s)" + ", ";
                            }
                            else {
                                weekDays += $(this).attr('id') + "(s)";
                                weekDays.length = (weekDays.length - 2);
                            }
                        }
                    });

                    html += "<p>" +
                                "<strong>On</strong> " + weekDays + "</p>";
                }

                if ($.trim($('select[name=StartTime]').val()) != "" && $.trim($('select[name=EndTime]').val()) != "") {
                    html += "<p>" +
                                "<strong>Between</strong> " + $('select[name=StartTime]').val() + " <strong>And</strong> " + $('select[name=EndTime]').val() + "</p>";
                }

                if ($('input[name = selectedAvailability]').filter(':checked').length > 0) {
                    var length = $('input[name = selectedAvailability]').filter(':checked').length;
                    var avails = "";

                    $('input[name = selectedAvailability]').filter(':checked').each(function (index) {
                        avails += $(this).attr('id');
                    });
                    html += "<p>" +
                                "<strong>Setting Table Availability</strong> to " + avails + "</p>";
                }
            }

            $('#btmText').html(html);
        }

        function UpdateWeekDays() {
            $.post('/TableAvailablity/GetDayofWeekList?startDate=' + $('#StartDate').val() + '&endDate=' + $('#EndDate').val(),
                $('#daysOfWeek input').serialize(),
                function (data) {
                    if ($('#allDays').is(':checked'))
                        $('#allDays').click();

                    $('#daysOfWeek').html(data);

                    $('#daysOfWeek .custom_check').screwDefaultButtons({
                        image: "url(/images/checkbox.png)",
                        width: 24,
                        height: 24
                    });

                    $('input[name = selectedWeekDays]').change(function () {
                        UpdateBottomText();
                    });

                    UpdateBottomText();

                    if ($('input[name = selectedWeekDays]').filter(':not(:checked)').filter(':not(:disabled)').length == 0) {
                        if ($('#allDays').is(':not(:checked)'))
                            $('#allDays').click();
                    }
                });
        }

        function ValidateSelectedTime(select) {
            var minIndex = $('#edtTATimeRange select[name = StartTime]').children('option').filter(':selected').index();
            var maxIndex = $('#edtTATimeRange select[name = EndTime]').children('option').filter(':selected').index();

            if (minIndex < maxIndex)
                $(select).attr('previous', $(select).children('option').filter(':selected').val());
            else {
                alert('Start time should be less than end time.');
                $(select).val($(select).attr('previous')).attr('selected', true);
            }
        }
    </script>
}
<div class="middle-section calendar-sec">
    <div class="top-filter">
        <ul style="width: auto;">
            <li><a href="/Setting/Index">Settings</a></li>
            <li><a href="/User/Index">Users</a></li>
            <li><a href="/ShiftHour/Index">Hours</a></li>
            <li><a href="/Floor/Index">Floorplan</a></li>
            <li><a class="active" href="/TableAvailablity/Index">Table Availability</a></li>
            
        </ul>
        <div class="ta-search-edithd">
            TABLE AVAILABILITY<br />
            EDIT MODE
        </div>
    </div>
    <div class="for-edit-section" style="border-bottom: 0px;">
        @using (Ajax.BeginForm(
            "UpdateTimeRange",
            "TableAvailablity",
            new AjaxOptions
            {
                HttpMethod = "GET",
                UpdateTargetId = "edtTATimeRange",
                OnComplete = "{" +
                             "  $('#edtTATimeRange select[name = StartTime], #edtTATimeRange select[name = EndTime]').change(function () {" +
                             "      UpdateBottomText();" +
                             "  });" +
                             "}"
            },
            new
            {
                @id = "TATimeRangeForm"
            }))
        {
            @Html.HiddenFor(m => m.StartDate,
                new
                {
                    @onchange = "{" +
                                "   $('#TATimeRangeForm').submit();" +
                                "   UpdateWeekDays();" +
                                "}"
                })
            @Html.HiddenFor(m => m.EndDate,
                new
                {
                    @onchange = "{" +
                                "   $('#TATimeRangeForm').submit();" +
                                "   UpdateWeekDays();" +
                                "}"
                })
            @Html.HiddenFor(m => m.StartTime)
            @Html.HiddenFor(m => m.EndTime)
        }
        @using (Html.BeginForm(
            "Edit",
            "TableAvailablity",
            FormMethod.Post,
            new
            {
                @id = "formEdit"
            }))
        {
            <div class="ta-main">
                <ul>
                    <li>
                        <div class="ta-col-a" style="padding-top: 25px;">
                            Date Range
                        </div>
                        <div class="range-date">
                            <label>
                                From
                            </label>
                            <div class="date-picker">
                                @Html.TextBoxFor(m => m.StartDate, string.Format("0:dd/MM/yyyy"),
                                    new
                                    {
                                        @id = "StartDateEdit",
                                        @onchange = "{" +
                                                    "   $('#TATimeRangeForm #StartTime').val($('#formEdit select[name = StartTime]').val());" +
                                                    "   $('#TATimeRangeForm #EndTime').val($('#formEdit select[name = EndTime]').val());" +
                                                    "   $('#TATimeRangeForm #StartDate').val(this.value).change();" +
                                                    "}"
                                    })
                            </div>
                        </div>
                        <div class="range-date">
                            <label>
                                Until
                            </label><div class="date-picker">
                                @Html.TextBoxFor(m => m.EndDate, string.Format("0:dd/MM/yyyy"),
                                    new
                                    {
                                        @id = "EndDateEdit",
                                        @onchange = "{" +
                                                    "   $('#TATimeRangeForm #StartTime').val($('#formEdit select[name = StartTime]').val());" +
                                                    "   $('#TATimeRangeForm #EndTime').val($('#formEdit select[name = EndTime]').val());" +
                                                    "   $('#TATimeRangeForm #EndDate').val(this.value).change();" +
                                                    "}"
                                    })
                            </div>
                        </div>
                        <div class="ta-col-a" style="width: 147px; padding-top: 25px; padding-left: 10px;">
                            Time Range to Edit
                        </div>
                        <div id="edtTATimeRange">
                            @Html.Partial("TimeRangePartial", this.Model)
                        </div>
                    </li>
                    <li>
                        <div class="ta-col-a">
                            Days of week to Edit
                        </div>
                        <div class="row-check">
                            <span class="col-check">
                                <input class="custom_check" type="checkbox" name="apple" id="allDays" value="alldays" /><label for="allDays">All</label>
                            </span>
                            <div class="row-check" id="daysOfWeek">
                                @Html.Action("GetDayofWeekList", new { selectedDay = Model.selectedWeekDays, startDate = Model.StartDate, endDate = Model.EndDate })
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="ta-col-a">
                            Table(s) to which Edit will Apply
                        </div>
                        <div class="row-check">
                            <span class="col-check">
                                <input class="custom_check" type="checkbox" name="apple" id="all" value="days" /><label for="all">All</label>
                            </span>@*<a class="showall" href="#">Show All</a>*@
                            <div class="row-check">
                                @Html.Action("GetAvailableTablesList", new { selectedTable = Model.selectedTables })
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="ta-col-a">
                            Seating Availability Status to Apply
                        </div>
                        <div class="row-check">
                            @Html.Action("GetSeatingAvailabilityList", new { selectedAvail = Model.selectedAvailability })
                        </div>
                    </li>
                    <li>
                        <div class="ta-col-a">
                            Changes will Apply to
                        </div>
                        <div class="row-check">
                            <div id="btmText">
                                @*<p>
                                        <strong>Table</strong> 1,2 & Three</p>
                                    <p>
                                        <strong>On</strong> Sunday(s), Monday(s), Tuesday(s)</p>
                                    <p>
                                        <strong>From</strong> Tuesday, January 21st,2014 <strong>Until</strong> Thursday,
                                        March 26th, 2015</p>
                                    <p>
                                        <strong>Between</strong> 8:00 AM <strong>And</strong> 10:45 PM</p>
                                    <p>
                                        <strong>Between</strong> 8:00AM <strong>And</strong> 10:45PM</p>
                                    <p>
                                        <strong>Setting Table Availability</strong> to Online & In House</p>*@
                            </div>
                            <div class="buttons">
                                <input type="submit" value="Save" name="" />
                                <input type="button" value="Cancel" name="" onclick="window.location.href = '/TableAvailablity'" />
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        }
    </div>
</div>
